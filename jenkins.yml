- hosts: localhost
  become: true

  vars:
    # jenkins_repo_url: https://pkg.jenkins.io/redhat-stable/jenkins.repo
    # jenkins_repo_key_url: https://pkg.jenkins.io/redhat-stable/jenkins.io.key
    # jenkins_pkg_url: https://pkg.jenkins.io/redhat-stable
    jenkins_version: "2.289.2"
    jenkins_plugins: ['docker-plugin', 'google-kubernetes-engine','uno-choice', 'ansible', 'artifactory', 'blueocean', 'build-name-setter', 
    'build-timeout', 'configuration-as-code', 'emailext-template', 'environment-script', 'greenballs', 'monitoring', 'rebuild', 'schedule-build', 
    'ssh-slaves', 'tfs', 'workflow-aggregator', 'ws-cleanup', 'kubernetes', 'pipeline-maven', 'timestamper']
    java_packages:
      - openjdk-11-jdk
    jenkins_prefer_lts: true
  
  roles:
    - geerlingguy.java
    - geerlingguy.jenkins
    - ansible-role-jenkins

  post_tasks:
    - name: Check installed version of Jenkins.
      command: rpm -q jenkins
      args:
        warn: false
      changed_when: false
      register: jenkins_rpm_version
      tags: ['skip_ansible_lint']

    - name: Print installed Jenkins package information.
      debug: var=jenkins_rpm_version

    - name: Fail if version doesn't match what we wanted.
      fail:
      when: "jenkins_version not in jenkins_rpm_version.stdout"