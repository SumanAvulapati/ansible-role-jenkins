- hosts: localhost
  become: true

  vars:
    # jenkins_repo_url: https://pkg.jenkins.io/redhat-stable/jenkins.repo
    # jenkins_repo_key_url: https://pkg.jenkins.io/redhat-stable/jenkins.io.key
    jenkins_pkg_url: https://pkg.jenkins.io/redhat-stable
    jenkins_version: "2.289.2"
    jenkins_plugins: ['ansible', 'blueocean', 'build-name-setter', 'build-timeout', 'configuration-as-code',  'monitoring', 'rebuild', 
    'schedule-build', 'kubernetes', 'pipeline-maven', 'timestamper', 'docker-plugin', 'docker-workflow', 'google-kubernetes-engine', 
    'greenballs', 'ssh-slaves', 'workflow-aggregator', 'ws-cleanup'] 
    # Additional plugins
    # 'tfs', 'uno-choice', 'artifactory', 'emailext-template', 'environment-script']
    java_packages:
      - java-11-openjdk
    jenkins_prefer_lts: true
  
  roles:
    - geerlingguy.java
    - geerlingguy.jenkins
    - ansible-role-jenkins

  post_tasks:
    - name: Check installed version of Jenkins.
      command: rpm -q jenkins
      args:
        warn: false
      changed_when: false
      register: jenkins_rpm_version
      tags: ['skip_ansible_lint']

    - name: Print installed Jenkins package information.
      debug: var=jenkins_rpm_version

    - name: Fail if version doesn't match what we wanted.
      fail:
      when: "jenkins_version not in jenkins_rpm_version.stdout"